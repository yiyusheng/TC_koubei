limit_min <- mean(ori_value) + rate*sd(ori_value)
ori_value[ori_value > limit_max] <- limit_max
ori_value[ori_value < limit_min] <- limit_min
data_pred_dcast[i,2:(k+1)] <- ori_value
print(ori_value)
}
for(i in 1:2){
ori_value <- data_pred_dcast[i,2:(k+1)]
limit_max <- mean(ori_value) - rate*sd(ori_value)
limit_min <- mean(ori_value) + rate*sd(ori_value)
ori_value[ori_value > limit_max] <- limit_max
ori_value[ori_value < limit_min] <- limit_min
data_pred_dcast[i,2:(k+1)] <- ori_value
print(ori_value)
}
i = 1
ori_value <- data_pred_dcast[i,2:(k+1)]
limit_max <- mean(ori_value) - rate*sd(ori_value)
mean(ori_value) - rate*sd(ori_value)
mean(ori_value)
ori_value <- as.numeric(data_pred_dcast[i,2:(k+1)])
limit_max <- mean(ori_value) - rate*sd(ori_value)
limit_min <- mean(ori_value) + rate*sd(ori_value)
ori_value[ori_value > limit_max] <- limit_max
ori_value[ori_value < limit_min] <- limit_min
data_pred_dcast[i,2:(k+1)] <- ori_value
for(i in 1:nrow(data_pred_dcast)){
ori_value <- as.numeric(data_pred_dcast[i,2:(k+1)])
limit_max <- mean(ori_value) - rate*sd(ori_value)
limit_min <- mean(ori_value) + rate*sd(ori_value)
ori_value[ori_value > limit_max] <- limit_max
ori_value[ori_value < limit_min] <- limit_min
data_pred_dcast[i,2:(k+1)] <- ori_value
print(ori_value)
}
data_pred <- melt(data_pred_dcast[,1:(k+1)],id.vars = 'shop_id')
source('D:/Git/TC_koubei/gen_result_last_week.R')
rm(list = ls())
source('head.R')
source('gen_result_last_week_Func.R')
load(file.path(dir_data,'shop_pay.Rda'))
load(file.path(dir_data,'shop_info.Rda'))
title <- '0209b.csv'
flag_gen <- 0
ifelse(flag_gen == 0,test_end <- as.p('2016-11-01'),test_end <- as.p('2016-11-15'))
test_start <- test_end - 14*86400
k <- 7
x <- ifelse(flag_gen == 0,test_end <- as.p('2016-11-01'),test_end <- as.p('2016-11-15'))
test_start <- test_end - 14*86400
k <- 7
data_pred <- extract_data(shop_pay,k)
list[data_pred,data_pred_dcast] <- fill_missing_data(data_pred,k)
data_pred <- volt_limit(data_pred_dcast,k,2)
data_pred <- expand_data(data_pred,k)
View(data_pred)
data_pred <- extract_data(shop_pay,k)
list[data_pred,data_pred_dcast] <- fill_missing_data(data_pred,k)
data_pred <- volt_limit(data_pred_dcast,k,2)
View(data_pred)
data_pred <- extract_data(shop_pay,k)
list[data_pred,data_pred_dcast] <- fill_missing_data(data_pred,k)
i = 1
for(i in 1:nrow(data_pred_dcast)){
ori_value <- as.numeric(data_pred_dcast[i,2:(k+1)])
limit_max <- mean(ori_value) - rate*sd(ori_value)
limit_min <- mean(ori_value) + rate*sd(ori_value)
ori_value[ori_value > limit_max] <- limit_max
ori_value[ori_value < limit_min] <- limit_min
data_pred_dcast[i,2:(k+1)] <- ori_value
}
rate = 2
for(i in 1:nrow(data_pred_dcast)){
ori_value <- as.numeric(data_pred_dcast[i,2:(k+1)])
limit_max <- mean(ori_value) - rate*sd(ori_value)
limit_min <- mean(ori_value) + rate*sd(ori_value)
ori_value[ori_value > limit_max] <- limit_max
ori_value[ori_value < limit_min] <- limit_min
data_pred_dcast[i,2:(k+1)] <- ori_value
}
View(data_pred_dcast)
2:(k+1)
data_pred_dcast[,1:(k+1)]
data_pred <- melt(data_pred_dcast[,1:(k+1)],id.vars = 'shop_id')
View(data_pred)
data_pred <- extract_data(shop_pay,k)
list[data_pred,data_pred_dcast] <- fill_missing_data(data_pred,k)
i = 1
for(i in 1:nrow(data_pred_dcast)){
ori_value <- as.numeric(data_pred_dcast[i,2:(k+1)])
limit_max <- mean(ori_value) - rate*sd(ori_value)
limit_min <- mean(ori_value) + rate*sd(ori_value)
ori_value[ori_value > limit_max] <- limit_max
ori_value[ori_value < limit_min] <- limit_min
data_pred_dcast[i,2:(k+1)] <- ori_value
}
View(data_pred_dcast)
data_pred <- extract_data(shop_pay,k)
list[data_pred,data_pred_dcast] <- fill_missing_data(data_pred,k)
i = 1
ori_value <- as.numeric(data_pred_dcast[i,2:(k+1)])
limit_max <- mean(ori_value) - rate*sd(ori_value)
limit_min <- mean(ori_value) + rate*sd(ori_value)
ori_value > limit_max
ori_value
limit_max
source('D:/Git/TC_koubei/gen_result_last_week_Func.R')
for(i in 1:nrow(data_pred_dcast)){
ori_value <- as.numeric(data_pred_dcast[i,2:(k+1)])
limit_min <- mean(ori_value) - rate*sd(ori_value)
limit_max <- mean(ori_value) + rate*sd(ori_value)
ori_value[ori_value > limit_max] <- limit_max
ori_value[ori_value < limit_min] <- limit_min
data_pred_dcast[i,2:(k+1)] <- ori_value
}
data_pred <- melt(data_pred_dcast[,1:(k+1)],id.vars = 'shop_id')
View(data_pred)
source('D:/Git/TC_koubei/gen_result_last_week.R')
rm(list = ls())
source('head.R')
source('gen_result_last_week_Func.R')
load(file.path(dir_data,'shop_pay.Rda'))
load(file.path(dir_data,'shop_info.Rda'))
title <- '0209b.csv'
flag_gen <- 0
x <- ifelse(flag_gen == 0,test_end <- as.p('2016-11-01'),test_end <- as.p('2016-11-15'))
test_start <- test_end - 14*86400
k <- 7
data_pred <- extract_data(shop_pay,k)
list[data_pred,data_pred_dcast] <- fill_missing_data(data_pred,k)
data_pred <- volt_limit(data_pred_dcast,k,2)
View(data_pred)
data_pred <- expand_data(data_pred,k)
data_pred <- extract_data(shop_pay,k)
list[data_pred,data_pred_dcast] <- fill_missing_data(data_pred,k)
data_pred <- volt_limit(data_pred_dcast,k,2)
a <- data_pred
k
rp <- ceiling(14/k)
rp
data_pred_expand <- lapply(seq_len(rp),function(i){
data_pred$uni_time <- data_pred$uni_time + 86400 * k * i
data_pred
})
source('D:/Git/TC_koubei/gen_result_last_week_Func.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
rm(list = ls())
source('head.R')
source('gen_result_last_week_Func.R')
load(file.path(dir_data,'shop_pay.Rda'))
load(file.path(dir_data,'shop_info.Rda'))
title <- '0209b.csv'
flag_gen <- 0
x <- ifelse(flag_gen == 0,test_end <- as.p('2016-11-01'),test_end <- as.p('2016-11-15'))
test_start <- test_end - 14*86400
k <- 7
data_pred <- extract_data(shop_pay,k)
list[data_pred,data_pred_dcast] <- fill_missing_data(data_pred,k)
data_pred <- volt_limit(data_pred_dcast,k,2)
data_pred <- expand_data(data_pred,k)
data_pred <- extract_data(shop_pay,k)
list[data_pred,data_pred_dcast] <- fill_missing_data(data_pred,k)
data_pred <- volt_limit(data_pred_dcast,k,2)
source('D:/Git/TC_koubei/gen_result_last_week_Func.R')
data_pred <- extract_data(shop_pay,k)
list[data_pred,data_pred_dcast] <- fill_missing_data(data_pred,k)
data_pred <- volt_limit(data_pred_dcast,k,2)
data_pred <- expand_data(data_pred,k)
data_comp <- add_real(data_pred)
cat(sprintf('Last %.0f days\t',k))
if(nrow(data_comp) != 0){
r <- check_result(data_comp)
}
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
sapply(seq(1,1.4,0.03),main)
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
View(r)
k <- 7;vl <- 1.2
data_pred <- extract_data(shop_pay,k)
list[data_pred,data_pred_dcast] <- fill_missing_data(data_pred,k)
data_pred <- volt_limit(data_pred_dcast,k,vl)
data_pred <- expand_data(data_pred,k)
data_comp <- add_real(data_pred)
cat(sprintf('Last %.0f days\tpa:%.4f\t',k,pa))
if(nrow(data_comp) != 0){
r <- check_result(data_comp)
}
if(flag_gen == 1){
data_pred <-
r <- gen_csv(data_pred,title)
}
r
View(data_pred)
data_pred <- round(data_pred)
source('D:/Git/TC_koubei/gen_result_last_week.R')
rm(list = ls())
source('head.R')
source('gen_result_last_week_Func.R')
load(file.path(dir_data,'shop_pay.Rda'))
load(file.path(dir_data,'shop_info.Rda'))
flag_gen <- 1;title <- '0209b.csv'
x <- ifelse(flag_gen == 0,test_end <- as.p('2016-11-01'),test_end <- as.p('2016-11-15'))
test_start <- test_end - 14*86400
k <- 7;vl <- 1.2
data_pred <- extract_data(shop_pay,k)
list[data_pred,data_pred_dcast] <- fill_missing_data(data_pred,k)
data_pred <- volt_limit(data_pred_dcast,k,vl)
data_pred <- expand_data(data_pred,k)
data_comp <- add_real(data_pred)
cat(sprintf('Last %.0f days\tpa:%.4f\t',k,pa))
pa = 0
cat(sprintf('Last %.0f days\tpa:%.4f\t',k,pa))
if(nrow(data_comp) != 0){
r <- check_result(data_comp)
}
if(flag_gen == 1){
data_pred <- round(data_pred)
r <- gen_csv(data_pred,title)
}
source('D:/Git/TC_koubei/gen_result_last_week.R')
View(r)
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
View(r)
summary(r)
flag_gen <- -1;title <- '0209b.csv'
x <- ifelse(flag_gen == 1,test_end <- as.p('2016-11-15'),
ifelse(flag_gen == 0,test_end <- as.p('2016-11-01',test_end <- as.p('2016-10-18'))))
x <- ifelse(flag_gen == 1,test_end <- as.p('2016-11-15'),
ifelse(flag_gen == 0,test_end <- as.p('2016-11-01'),test_end <- as.p('2016-10-18')))
test_end
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
View(data_pred)
main <- function(pa){
k <- 7;vl <- 1.2
data_pred <- extract_data(shop_pay,k)
list[data_pred,data_pred_dcast] <- fill_missing_data(data_pred,k)
data_pred <- volt_limit(data_pred_dcast,k,vl)
data_pred <- expand_data(data_pred,k)
data_comp <- add_real(data_pred)
cat(sprintf('Last %.0f days\tpa:%.4f\t',k,pa))
if(nrow(data_comp) != 0){
r <- check_result(data_comp)
}
if(flag_gen == 1){
data_pred$value <- round(data_pred$value)
r <- gen_csv(data_pred,title)
}
data_comp
}
data_pred <- main(0)
data_comp <- main(0)
View(data_comp)
source('D:/Git/TC_koubei/gen_result_last_week.R')
View(r)
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
k <- 7;vl <- 1.2
data_pred <- extract_data(shop_pay,k)
list[data_pred,data_pred_dcast] <- fill_missing_data(data_pred,k)
data_pred <- volt_limit(data_pred_dcast,k,vl)
data_pred <- expand_data(data_pred,k)
data_comp <- add_real(data_pred)
View(data_comp)
error <- mean(data_comp$ms)
seq.POSIXt(as.p('2016-09-01'),as.p('2016-11-01'))
seq.POSIXt(as.p('2016-09-01'),as.p('2016-11-01'),by = 'days')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
debugSource('D:/Git/TC_koubei/gen_result_last_week.R')
debugSource('D:/Git/TC_koubei/gen_result_last_week.R')
debugSource('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
warnings()
r1 <- do.call(rbind,r1)
r1 <- do.call(rbind,r)
r1 <- lapply(r,'[[',1)
r1 <- lapply(r,'[[',1);r1 <- do.call(rbind,r1)
r1 <- lapply(r,'[[',1);r1 <- do.call(rbind,r1)
r2 <- lapply(r,'[[',2);r2 <- do.call(rbind,r2)
r3 <- data.frame(date = as.POSIXct(r1,tz = 'UTC',origin = '1970-01-01'),
error = r2)
View(r3)
ggplot(r3,aes(x = date,y = error)) + geom_line() + geom_point()
pa <- as.p('2016-08-01')
test_start <- pa - 14*86400
k <- 7;vl <- 1.2
data_pred <- extract_data(shop_pay,k,test_start,teset_end)
test_end
test_end <- pa
test_start <- pa - 14*86400
k <- 7;vl <- 1.2
data_pred <- extract_data(shop_pay,k,test_start,teset_end)
data_pred <- subset(shop_pay,uni_time >= (test_start - 86400*k) & uni_time < test_start)
broken_shop <- dcast(shop_id~uni_time,data = data_pred,value.var = 'value')
broken_shop$num_na <- apply(broken_shop,1,function(x)sum(is.na(x)))
missing_shop <- c(broken_shop$shop_id[broken_shop$num_na >= 3],
setdiff(unique(shop_pay$shop_id),unique(data_pred$shop_id)))
weekday_end <- as.POSIXlt(test_end - 86400)$wday
missing_data <- lapply(missing_shop,function(i){
shop_data <- subset(shop_pay,shop_id == i & uni_time < (test_start - 86400*k))
last_day <- max(shop_data$uni_time[as.POSIXlt(shop_data$uni_time)$wday == weekday_end]) + 86400
md <- subset(shop_data,uni_time < last_day & uni_time >= (last_day - 86400*k))
md$uni_time <- md$uni_time + difftime(test_start,last_day,units = 'secs')
md
})
View(broken_shop)
i = 1
i <- missing_shop[1]
shop_data <- subset(shop_pay,shop_id == i & uni_time < (test_start - 86400*k))
(test_start - 86400*k)
last_day <- max(shop_data$uni_time[as.POSIXlt(shop_data$uni_time)$wday == weekday_end]) + 86400
md <- subset(shop_data,uni_time < last_day & uni_time >= (last_day - 86400*k))
md$uni_time <- md$uni_time + difftime(test_start,last_day,units = 'secs')
i <- missing_shop[30]
shop_data <- subset(shop_pay,shop_id == i & uni_time < (test_start - 86400*k))
last_day <- max(shop_data$uni_time[as.POSIXlt(shop_data$uni_time)$wday == weekday_end]) + 86400
md <- subset(shop_data,uni_time < last_day & uni_time >= (last_day - 86400*k))
md$uni_time <- md$uni_time + difftime(test_start,last_day,units = 'secs')
missing_data <- lapply(missing_shop,function(i){
shop_data <- subset(shop_pay,shop_id == i & uni_time < (test_start - 86400*k))
last_day <- max(shop_data$uni_time[as.POSIXlt(shop_data$uni_time)$wday == weekday_end]) + 86400
md <- subset(shop_data,uni_time < last_day & uni_time >= (last_day - 86400*k))
md$uni_time <- md$uni_time + difftime(test_start,last_day,units = 'secs')
md
})
i=1
shop_data <- subset(shop_pay,shop_id == i & uni_time < (test_start - 86400*k))
last_day <- max(shop_data$uni_time[as.POSIXlt(shop_data$uni_time)$wday == weekday_end]) + 86400
md <- subset(shop_data,uni_time < last_day & uni_time >= (last_day - 86400*k))
md$uni_time <- md$uni_time + difftime(test_start,last_day,units = 'secs')
i=2
shop_data <- subset(shop_pay,shop_id == i & uni_time < (test_start - 86400*k))
last_day <- max(shop_data$uni_time[as.POSIXlt(shop_data$uni_time)$wday == weekday_end]) + 86400
md <- subset(shop_data,uni_time < last_day & uni_time >= (last_day - 86400*k))
md$uni_time <- md$uni_time + difftime(test_start,last_day,units = 'secs')
i=3
shop_data <- subset(shop_pay,shop_id == i & uni_time < (test_start - 86400*k))
last_day <- max(shop_data$uni_time[as.POSIXlt(shop_data$uni_time)$wday == weekday_end]) + 86400
md <- subset(shop_data,uni_time < last_day & uni_time >= (last_day - 86400*k))
md$uni_time <- md$uni_time + difftime(test_start,last_day,units = 'secs')
i <- missing_shop[1]
shop_data <- subset(shop_pay,shop_id == i & uni_time < (test_start - 86400*k))
last_day <- max(shop_data$uni_time[as.POSIXlt(shop_data$uni_time)$wday == weekday_end]) + 86400
md <- subset(shop_data,uni_time < last_day & uni_time >= (last_day - 86400*k))
md$uni_time <- md$uni_time + difftime(test_start,last_day,units = 'secs')
i <- missing_shop[2]
shop_data <- subset(shop_pay,shop_id == i & uni_time < (test_start - 86400*k))
last_day <- max(shop_data$uni_time[as.POSIXlt(shop_data$uni_time)$wday == weekday_end]) + 86400
md <- subset(shop_data,uni_time < last_day & uni_time >= (last_day - 86400*k))
md$uni_time <- md$uni_time + difftime(test_start,last_day,units = 'secs')
i <- missing_shop[3]
shop_data <- subset(shop_pay,shop_id == i & uni_time < (test_start - 86400*k))
last_day <- max(shop_data$uni_time[as.POSIXlt(shop_data$uni_time)$wday == weekday_end]) + 86400
md <- subset(shop_data,uni_time < last_day & uni_time >= (last_day - 86400*k))
md$uni_time <- md$uni_time + difftime(test_start,last_day,units = 'secs')
i <- missing_shop[4]
shop_data <- subset(shop_pay,shop_id == i & uni_time < (test_start - 86400*k))
last_day <- max(shop_data$uni_time[as.POSIXlt(shop_data$uni_time)$wday == weekday_end]) + 86400
md <- subset(shop_data,uni_time < last_day & uni_time >= (last_day - 86400*k))
md$uni_time <- md$uni_time + difftime(test_start,last_day,units = 'secs')
i <- missing_shop[5]
shop_data <- subset(shop_pay,shop_id == i & uni_time < (test_start - 86400*k))
last_day <- max(shop_data$uni_time[as.POSIXlt(shop_data$uni_time)$wday == weekday_end]) + 86400
md <- subset(shop_data,uni_time < last_day & uni_time >= (last_day - 86400*k))
md$uni_time <- md$uni_time + difftime(test_start,last_day,units = 'secs')
i
shop_data <- subset(shop_pay,shop_id == i & uni_time < (test_start - 86400*k))
shop_data <- subset(shop_pay,shop_id == i & uni_time < (test_start - 86400*k))
last_day <- max(shop_data$uni_time[as.POSIXlt(shop_data$uni_time)$wday == weekday_end]) + 86400
md <- subset(shop_data,uni_time < last_day & uni_time >= (last_day - 86400*k))
md$uni_time <- md$uni_time + difftime(test_start,last_day,units = 'secs')
missing_data <- lapply(missing_shop,function(i){
shop_data <- subset(shop_pay,shop_id == i & uni_time < (test_start - 86400*k))
if(nrow(shop_data) == 0)return(NULL)
last_day <- max(shop_data$uni_time[as.POSIXlt(shop_data$uni_time)$wday == weekday_end]) + 86400
md <- subset(shop_data,uni_time < last_day & uni_time >= (last_day - 86400*k))
md$uni_time <- md$uni_time + difftime(test_start,last_day,units = 'secs')
md
})
missing_data <- lapply(missing_shop,function(i){
cat(i)
shop_data <- subset(shop_pay,shop_id == i & uni_time < (test_start - 86400*k))
if(nrow(shop_data) == 0)return(NULL)
last_day <- max(shop_data$uni_time[as.POSIXlt(shop_data$uni_time)$wday == weekday_end]) + 86400
md <- subset(shop_data,uni_time < last_day & uni_time >= (last_day - 86400*k))
md$uni_time <- md$uni_time + difftime(test_start,last_day,units = 'secs')
md
})
cat(sprintf('%f\t',i))
missing_data <- lapply(missing_shop,function(i){
cat(sprintf('%f\t',i))
shop_data <- subset(shop_pay,shop_id == i & uni_time < (test_start - 86400*k))
if(nrow(shop_data) == 0)return(NULL)
last_day <- max(shop_data$uni_time[as.POSIXlt(shop_data$uni_time)$wday == weekday_end]) + 86400
md <- subset(shop_data,uni_time < last_day & uni_time >= (last_day - 86400*k))
md$uni_time <- md$uni_time + difftime(test_start,last_day,units = 'secs')
md
})
i <- 501
cat(sprintf('%f\t',i))
shop_data <- subset(shop_pay,shop_id == i & uni_time < (test_start - 86400*k))
if(nrow(shop_data) == 0)return(NULL)
last_day <- max(shop_data$uni_time[as.POSIXlt(shop_data$uni_time)$wday == weekday_end]) + 86400
md <- subset(shop_data,uni_time < last_day & uni_time >= (last_day - 86400*k))
md$uni_time <- md$uni_time + difftime(test_start,last_day,units = 'secs')
View(md)
setdiff(unique(shop_pay$shop_id),unique(data_pred$shop_id))
missing_data <- lapply(missing_shop,function(i){
cat(sprintf('%f\t',i))
shop_data <- subset(shop_pay,shop_id == i & uni_time < (test_start - 86400*k))
if(nrow(shop_data) == 0)return(NULL)
last_day <- max(shop_data$uni_time[as.POSIXlt(shop_data$uni_time)$wday == weekday_end]) + 86400
md <- subset(shop_data,uni_time < last_day & uni_time >= (last_day - 86400*k))
md$uni_time <- md$uni_time + difftime(test_start,last_day,units = 'secs')
md
})
missing_data <- do.call(rbind,missing_data)
View(missing_data)
length(unique(missing_data$shop_id))
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
r1 <- lapply(r,'[[',1);r1 <- do.call(rbind,r1)
r2 <- lapply(r,'[[',2);r2 <- do.call(rbind,r2)
r3 <- data.frame(date = as.POSIXct(r1,tz = 'UTC',origin = '1970-01-01'),
error = r2)
ggplot(r3,aes(x = date,y = error)) + geom_line() + geom_point()
save(r3,readme,file = file.path(dir_data,'test_start.Rda'))
readme <- "It's a data.frame including date(test_start) and error. I use different test_start"
save(r3,readme,file = file.path(dir_data,'test_start.Rda'))
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
View(r)
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
View(r)
summary(r)
rm(list = ls())
source('head.R')
source('gen_result_last_week_Func.R')
load(file.path(dir_data,'shop_pay.Rda'))
load(file.path(dir_data,'shop_info.Rda'))
flag_gen <- 1;title <- '0210a.csv'
x <- ifelse(flag_gen == 1,test_end <- as.p('2016-11-15'),
ifelse(flag_gen == 0,test_end <- as.p('2016-11-01'),test_end <- as.p('2016-11-01')))
test_start <- test_end - 14*86400
k <- 7;vl <- 1.2
data_pred <- extract_data(shop_pay,k,test_start,teset_end)
list[data_pred,data_pred_dcast] <- fill_missing_data(data_pred,k)
data_pred <- volt_limitB(data_pred_dcast,k,vl)
summary(data_pred$value)
data_pred <- extract_data(shop_pay,k,test_start,teset_end)
list[data_pred,data_pred_dcast] <- fill_missing_data(data_pred,k)
summary(data_pred$value)
source('D:/Git/TC_koubei/gen_result_last_week_Func.R')
source('D:/Git/TC_koubei/gen_result_last_week_Func.R')
data_pred <- extract_data(shop_pay,k,test_start,teset_end)
list[data_pred,data_pred_dcast] <- fill_missing_data(data_pred,k)
data_pred <- volt_limitB(data_pred_dcast,k,vl)
summary(data_pred$value)
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
