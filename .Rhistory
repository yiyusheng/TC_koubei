list[data_pred,data_pred_dcast] <- fill_missing_data(data_pred,k)
a <- data_pred_dcast
for(i in 1:nrow(data_pred_dcast)){
ori_value <- as.numeric(data_pred_dcast[i,2:(k+1)])
limit_min <- max(1,mean(ori_value) - volt_limit_weight*sd(ori_value))
limit_max <- mean(ori_value) + volt_limit_weight*sd(ori_value)
if(any(ori_value > limit_max) | any(ori_value < limit_min)){
data_pred_dcast[i,2:(k+1)] <- linMap(ori_value,limit_min,limit_max)
}
}
data_pred <- melt(data_pred_dcast[,1:(k+1)],id.vars = 'shop_id')
names(data_pred) <- c('shop_id','uni_time','value')
data_pred$uni_time <- as.p(data_pred$uni_time)
data_predB <- data_pred
data_pred_dcast <- a
last_k <- 1
for(i in 1:nrow(data_pred_dcast)){
ori_value <- as.numeric(data_pred_dcast[i,2:(k+1)])
len_aggr <- nrow(smp_aggra[[i]])
data_mean <- smp_aggra[[i]]$smp_mean;data_mean <- data_mean[!is.na(data_mean)]
data_mean <- mean(data_mean[max(1,(length(data_mean)-last_k+1)):length(data_mean)],na.rm = T)
data_sd <- smp_aggra[[i]]$smp_sd;data_sd <- data_sd[!is.na(data_sd)]
data_sd <- mean(data_sd[max(1,(length(data_sd)-last_k+1)):length(data_sd)],na.rm = T)
limit_min <- max(1,data_mean - volt_limit_weight*data_sd)
limit_max <- data_mean + volt_limit_weight*data_sd
# cat(i)
if(any(ori_value > limit_max) | any(ori_value < limit_min)){
data_pred_dcast[i,2:(k+1)] <- linMap(ori_value,limit_min,limit_max)
}
}
data_pred <- melt(data_pred_dcast[,1:(k+1)],id.vars = 'shop_id')
names(data_pred) <- c('shop_id','uni_time','value')
data_pred$uni_time <- as.p(data_pred$uni_time)
data_pred$value <- abs(data_pred$value)
data_predC <- data_pred
View(data_predB)
View(data_predC)
m <- merge(data_predB,data_predC)
View(m)
m <- merge(data_predB,data_predC,by = c('shop_id','uni_time'))
m$diff <- abs(m$value.x - m$value.y)
i = 1269
ori_value <- as.numeric(data_pred_dcast[i,2:(k+1)])
len_aggr <- nrow(smp_aggra[[i]])
data_mean <- smp_aggra[[i]]$smp_mean;data_mean <- data_mean[!is.na(data_mean)]
data_mean <- mean(data_mean[max(1,(length(data_mean)-last_k+1)):length(data_mean)],na.rm = T)
data_sd <- smp_aggra[[i]]$smp_sd;data_sd <- data_sd[!is.na(data_sd)]
data_sd <- mean(data_sd[max(1,(length(data_sd)-last_k+1)):length(data_sd)],na.rm = T)
limit_min <- max(1,data_mean - volt_limit_weight*data_sd)
limit_max <- data_mean + volt_limit_weight*data_sd
ori_value <- as.numeric(data_pred_dcast[i,2:(k+1)])
limit_min <- max(1,mean(ori_value) - volt_limit_weight*sd(ori_value))
limit_max <- mean(ori_value) + volt_limit_weight*sd(ori_value)
sd(ori_value)
data_sd
smp_aggra[[i]]$smp_sd
data_sd[max(1,(length(data_sd)-last_k+1)):length(data_sd)]
shop_pay_train <- subset(shop_pay,uni_time < test_start)
min_date <- min(shop_pay_train$uni_time)
cut_date <- seq.POSIXt(test_start,min_date,by = -86400*k)
shop_pay_train$datecut <- cut.POSIXt(shop_pay_train$uni_time,cut_date)
split_shop_pay <- split(shop_pay_train,shop_pay_train$shop_id)
df <- split_shop_pay[[1269]]
r <- tapply(df$value,factor(df$datecut),function(x)list(mean(x),sd(x)))
View(df)
i
ori_value <- as.numeric(data_pred_dcast[i,2:(k+1)])
View(data_pred_dcast)
source('D:/Git/TC_koubei/gen_result_last_week_Func.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
data_pred <- extract_data(shop_pay,k,test_start,teset_end)
list[data_pred,data_pred_dcast,data_na] <- fill_missing_data(data_pred,k)
i = 1269
volt_limit_weight
ori_value <- as.numeric(data_pred_dcast[i,2:(k+1)])
data_na[i,2:(k+1)]
length(data_na == T)
sum(data_na)
ori_value <- as.numeric(data_pred_dcast[i,2:(k+1)])
meanD <- mean(ori_value[!data_na[i,2:(k+1)]])
sdD <- sd(ori_value[!data_na[i,2:(k+1)]])
limit_min <- max(1,meanD - volt_limit_weight*sdD)
limit_max <- meanD + volt_limit_weight*sdD
i
ori_value <- as.numeric(data_pred_dcast[i,2:(k+1)])
len_aggr <- nrow(smp_aggra[[i]])
data_mean <- smp_aggra[[i]]$smp_mean;data_mean <- data_mean[!is.na(data_mean)]
data_mean <- mean(data_mean[max(1,(length(data_mean)-last_k+1)):length(data_mean)],na.rm = T)
data_sd <- smp_aggra[[i]]$smp_sd;data_sd <- data_sd[!is.na(data_sd)]
data_sd <- mean(data_sd[max(1,(length(data_sd)-last_k+1)):length(data_sd)],na.rm = T)
limit_min <- max(1,data_mean - volt_limit_weight*data_sd)
limit_max <- data_mean + volt_limit_weight*data_sd
ori_value <- as.numeric(data_pred_dcast[i,2:(k+1)])
ori_value <- as.numeric(data_pred_dcast[i,2:(k+1)])
ori_value <- as.numeric(data_pred_dcast[i,2:(k+1)])
meanD <- mean(ori_value[!data_na[i,2:(k+1)]])
sdD <- sd(ori_value[!data_na[i,2:(k+1)]])
data_mean <- smp_aggra[[i]]$smp_mean;data_mean <- data_mean[!is.na(data_mean)]
data_mean <- mean(data_mean[max(1,(length(data_mean)-last_k+1)):length(data_mean)],na.rm = T)
data_sd <- smp_aggra[[i]]$smp_sd;data_sd <- data_sd[!is.na(data_sd)]
data_sd <- mean(data_sd[max(1,(length(data_sd)-last_k+1)):length(data_sd)],na.rm
data_mean <- smp_aggra[[i]]$smp_mean;data_mean <- data_mean[!is.na(data_mean)]
data_mean <- mean(data_mean[max(1,(length(data_mean)-last_k+1)):length(data_mean)],na.rm = T)
data_sd <- smp_aggra[[i]]$smp_sd;data_sd <- data_sd[!is.na(data_sd)]
data_sd <- mean(data_sd[max(1,(length(data_sd)-last_k+1)):length(data_sd)],na.rm = T)
ori_value[!data_na[i,2:(k+1)]]
ori_value <- as.numeric(data_pred_dcast[i,2:(k+1)])
ori_value
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
pa <- 1.05
data_pred <- extract_data(shop_pay,k,test_start,teset_end)
list[data_pred,data_pred_dcast,data_na] <- fill_missing_data(data_pred,k)
data_pred <- smp_tuningB(data_pred_dcast,data_na,k,pa)
data_pred <- expand_data(data_pred,k)
data_comp <- add_real(data_pred,test_start,teset_end)
error <- mean(data_comp$ms)
cat(sprintf('pa:%s\t\tError:%.8f\n',
pa,error))
View(data_comp)
aggr_ms <- data.frame(shop_id = levels(data_comp$shop_id),
mean = as.numeric(tapply(data_comp$ms,data_comp$shop_id,mean)))
levels(data_comp$shop_id)
data_comp$shop_id <- factor(data_comp$shop_id)
aggr_ms <- data.frame(shop_id = levels(data_comp$shop_id),
mean = as.numeric(tapply(data_comp$ms,data_comp$shop_id,mean)))
source('D:/Git/TC_koubei/gen_result_last_week.R')
View(r)
source('D:/Git/TC_koubei/gen_result_last_week.R')
View(r)
source('D:/Git/TC_koubei/gen_result_last_week.R')
View(r)
source('D:/Git/TC_koubei/gen_result_last_week.R')
r1 <- do.call(rbind(r))
r1 <- do.call(rbind,r)
r1 <- do.call(merge,r)
r1 <- do.call(merge,r,by = 'shop_id')
source('D:/Git/TC_koubei/gen_result_last_week.R')
r1 <- do.call(merge,r,by = 'shop_id')
r1 <- do.call(rbind(r))
r1 <- do.call(rbind,r)
View(r1)
r2 <- dcast(shop_id~pa,value.var = 'mean')
r2 <- dcast(shop_id~pa,r1,value.var = 'mean')
r2 <- dcast(shop_id~pa,data = r1,value.var = 'mean')
View(r2)
r2$shop_id <- fct2num(r2$shop_id)
View(r2)
r3 <- apply(r2,1,which.min)
summary(r3)
quantileX(r3)
source('D:/Git/TC_koubei/gen_result_last_week.R')
r2 <- dcast(shop_id~pa,data = r1,value.var = 'mean')
r1 <- do.call(rbind,r)
r2 <- dcast(shop_id~pa,data = r1,value.var = 'mean')
r2$shop_id <- fct2num(r2$shop_id)
r3 <- data.frame(shop_id = r2$shop_id,
vt = seq(0.01,3,0.01)[apply(r2,1,which.min) - 1])
View(r3)
quantileX(r3$vt)
volt_limit_set <- r3$vt
View(r3)
diffset(1:2000,r3$shop_id)
setdiff(1:2000,r3$shop_id)
r3 <- rbind(r3,c(1824,1))
r3 <- r3[order(r3$shop_id),]
View(r3)
volt_limit_set <- r3$vt
r1 <- do.call(rbind,r)
r2 <- dcast(shop_id~pa,data = r1,value.var = 'mean')
r2$shop_id <- fct2num(r2$shop_id)
r3 <- data.frame(shop_id = r2$shop_id,
vt = seq(0.01,3,0.01)[apply(r2,1,which.min) - 1])
r3 <- rbind(r3,c(1824,1))
r3 <- r3[order(r3$shop_id),]
volt_limit_set <- r3$vt
save(volt_limit_set,file = file.path(dir_data,'volt_limit_set.Rda'))
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
View(r)
data_na
data_pred <- extract_data(shop_pay,k,test_start,teset_end)
list[data_pred,data_pred_dcast,data_na] <- fill_missing_data(data_pred,k)
data_pred <- extract_data(shop_pay,k,test_start,teset_end)
list[data_pred,data_pred_dcast,data_na] <- fill_missing_data(data_pred,k)
View(r)
i = 1875
ori_value <- as.numeric(data_pred_dcast[i,2:(k+1)])
meanD <- mean(ori_value[!data_na[i,2:(k+1)]])
sdD <- sd(ori_value[!data_na[i,2:(k+1)]])
limit_min <- max(1,meanD - volt_limit_set[i]*sdD)
limit_max <- meanD + volt_limit_set[i]*sdD
get_shop(1875)
get_shop(1876)
get_shop(1875)
linMap(ori_value,limit_min,limit_max)
ori_value
volt_limit_set[i]
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week_Func.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week_Func.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
data_pred <- extract_data(shop_pay,k,test_start,teset_end)
list[data_pred,data_pred_dcast,data_na] <- fill_missing_data(data_pred,k)
i = 1464
ori_value <- as.numeric(data_pred_dcast[i,2:(k+1)])
meanD <- mean(ori_value[!data_na[i,2:(k+1)]])
sdD <- sd(ori_value[!data_na[i,2:(k+1)]])
data_na[i,2:(k+1)]
ori_value[!data_na[i,2:(k+1)]]
sd(5)
sd(c(5,6))
is.na(sd)
sd
is.na(sdD)
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
a < c(4,23,5,34,6)
a <- c(4,23,5,34,6)
sort(a)
order(a)
a[order(a)]
a[order(a)[1:2]]
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
data_pred <- extract_data(shop_pay,k,test_start,teset_end)
list[data_pred,data_pred_dcast,data_na] <- fill_missing_data(data_pred,k)
data_pred <- smp_tuningB(data_pred_dcast,data_na,k,pa)
pa <- 1.05
data_pred <- smp_tuningB(data_pred_dcast,data_na,k,pa)
data_pred <- expand_data(data_pred,k)
data_comp <- add_real(data_pred,test_start,teset_end)
error <- mean(data_comp$ms)
cat(sprintf('pa:%s\t\tError:%.8f\n',
pa,error))
rm(list = ls())
source('head.R')
source('gen_result_last_week_Func.R')
source('base.R')
load(file.path(dir_data,'shop_pay.Rda'))
load(file.path(dir_data,'shop_info.Rda'))
load(file.path(dir_data,'smp_aggra.Rda')) #smp_aggra <- gen_smp_aggra(shop_pay,test_start,k)
# load(file.path(dir_data,'volt_limit_set.Rda'))
flag_gen <- 2 #If generate the result
title <- '0211b.csv'  #file title
k <- 7  #days to extract as samples
volt_limit_weight <- 1.05
active_weight <- 1.1
last_k <- 1 #number of period used to adjust result
x <- ifelse(flag_gen == 1,test_end <- as.p('2016-11-15'),
ifelse(flag_gen == 0,test_end <- as.p('2016-11-01'),test_end <- as.p('2016-10-31')))
test_start <- test_end - 14*86400
data_pred <- extract_data(shop_pay,k,test_start,teset_end)
list[data_pred,data_pred_dcast,data_na] <- fill_missing_data(data_pred,k)
data_pred <- smp_tuningB(data_pred_dcast,data_na,k,pa)
# data_pred <- smp_tuningC(data_pred_dcast,smp_aggra,k,volt_limit_weight,last_k)
data_pred <- expand_data(data_pred,k)
data_comp <- add_real(data_pred,test_start,teset_end)
error <- mean(data_comp$ms)
cat(sprintf('pa:%s\t\tError:%.8f\n',
pa,error))
pa <- 1.05
data_pred <- extract_data(shop_pay,k,test_start,teset_end)
list[data_pred,data_pred_dcast,data_na] <- fill_missing_data(data_pred,k)
data_pred <- smp_tuningB(data_pred_dcast,data_na,k,pa)
# data_pred <- smp_tuningC(data_pred_dcast,smp_aggra,k,volt_limit_weight,last_k)
data_pred <- expand_data(data_pred,k)
data_comp <- add_real(data_pred,test_start,teset_end)
error <- mean(data_comp$ms)
cat(sprintf('pa:%s\t\tError:%.8f\n',
pa,error))
aggr_ms <- data.frame(shop_id = factor(data_comp$shop_id),
value  = as.numeric(tapply(data_comp$ms,data_comp$shop_id,mean))
aggr_ms$pa <- pa
return(aggr_ms)
return(data_comp)
}else{
data_pred$value[data_pred$uni_time > as.p('2016-11-10') & data_pred$uni_time < as.p('2016-11-13')] <-
data_pred$value[data_pred$uni_time > as.p('2016-11-10') & data_pred$uni_time < as.p('2016-11-13')]*active_weight
data_pred$value <- round(data_pred$value)
r <- gen_csv(data_pred,title)
cat(sprintf('Length:%d\tAll positive:%s\tAll numeric:%s',nrow(r),all(r >= 0),all(!is.na(r))))
return(r)
}
}
# r <- main(1.05)
# r <- lapply(seq(0.01,2.3,0.01),main)
r <- lapply(seq(0.01,2.3,0.01),main)
r1 <- do.call(rbind,r)
r2 <- dcast(shop_id~pa,data = r1,value.var = 'mean')
r2$shop_id <- fct2num(r2$shop_id)
r3 <- data.frame(shop_id = r2$shop_id,
vt = seq(0.01,2.3,0.01)[apply(r2,1,function(x)order[x][1:10]) - 1])
r3 <- rbind(r3,c(1824,1))
r3 <- r3[order(r3$shop_id),]
volt_limit_set <- r3$vt
save(volt_limit_set,file = file.path(dir_data,'volt_limit_set.Rda'))
aggr_ms <- data.frame(shop_id = factor(data_comp$shop_id),
value  = as.numeric(tapply(data_comp$ms,data_comp$shop_id,mean)))
data_comp$shop_id <- factor(data_comp$shop_id)
aggr_ms <- data.frame(shop_id = factor(data_comp$shop_id),
value  = as.numeric(tapply(data_comp$ms,data_comp$shop_id,mean)))
data_comp <- add_real(data_pred,test_start,teset_end)
error <- mean(data_comp$ms)
cat(sprintf('pa:%s\t\tError:%.8f\n',
pa,error))
data_comp$shop_id <- factor(data_comp$shop_id)
aggr_ms <- data.frame(shop_id = levels(data_comp$shop_id),
value  = as.numeric(tapply(data_comp$ms,data_comp$shop_id,mean)))
aggr_ms$pa <- pa
View(aggr_ms)
source('D:/Git/TC_koubei/gen_result_last_week.R')
r3 <- data.frame(shop_id = r2$shop_id,
vt = seq(0.01,2.3,0.01)[apply(r2,1,function(x)order[x][1:10]) - 1])
x <- r2[1,]
order[x][1:10])
order(x)[1:10]
View(r2)
order(x[2:ncol(r2)])
source('D:/Git/TC_koubei/gen_result_last_week.R')
r3 <- data.frame(shop_id = r2$shop_id,
vt = seq(0.01,2.3,0.01)[apply(r2,1,function(x)order(x[2:ncol(r2)])[1:10])])
2:ncol(r2)
x
x <- r2[1,]
order(x[2:ncol(r2)])[1
order(x[2:ncol(r2)])[1:10])]
apply(r2,1,function(x)order(x[2:ncol(r2)]))[1:10]
View(r2)
min(r2[1])
min(r2[1,])
seq(0.01,2.3,0.01)[apply(r2,1,function(x)order(x[2:ncol(r2)]))[1:10]]
r2$1.41[1]
r2[1,]
r3 <- data.frame(shop_id = r2$shop_id,
vt = seq(0.01,2.3,0.01)[apply(r2,1,function(x)order(x[2:ncol(r2)]))[1:10]])
r3 <- data.frame(shop_id = r2$shop_id,
vt = seq(0.01,2.3,0.01)[apply(r2,1,function(x)order(x[2:ncol(r2)]))[1:5]])
save(r2,file = file.path(dir_data,'volt_limit_set.Rda'))
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
source('D:/Git/TC_koubei/gen_result_last_week.R')
rm(list = ls())
source('head.R')
source('gen_result_last_week_Func.R')
source('base.R')
load(file.path(dir_data,'shop_pay.Rda'))
load(file.path(dir_data,'shop_info.Rda'))
load(file.path(dir_data,'smp_aggra.Rda')) #s
tdf <- smp_aggra[[1]]
df <- smp_aggra[[1]]
View(df)
ggplot(df, aes(x=uni_time, y=smp_mean)) +
geom_errorbar(aes(ymin=smp_mean-smp_sd, ymax=smp_mean+smp_sd), width=.1) +
geom_line() + geom_point()
ggplot(df, aes(x=uni_time, y=smp_mean, group = 1)) +
geom_errorbar(aes(ymin=smp_mean-smp_sd, ymax=smp_mean+smp_sd), width=.1) +
geom_line() + geom_point()
ggplot(df, aes(x=1:nrow(df), y=smp_mean, group = 1)) +
geom_errorbar(aes(ymin=smp_mean-smp_sd, ymax=smp_mean+smp_sd), width=.1) +
geom_line() + geom_point()
i = 1
ggplot(df, aes(x=1:nrow(df), y=smp_mean, group = 1)) +
geom_errorbar(aes(ymin=smp_mean-smp_sd, ymax=smp_mean+smp_sd), width=.1) +
geom_line() + geom_point() + xlab('weeks') + ylab('mean') + ggtitle(i)
source('D:/Git/TC_koubei/base.R')
source('D:/Git/TC_koubei/base.R')
source('D:/Git/TC_koubei/base.R')
x <- lapply(1:2000,plot_week_aggra)
source('D:/Git/TC_koubei/base.R')
x <- lapply(1:2000,plot_week_aggra)
df <- smp_aggra[[3]]
View(df)
source('D:/Git/TC_koubei/base.R')
x <- lapply(1:2000,plot_week_aggra)
source('D:/Git/TC_koubei/base.R')
i = 1
cat(i)
df <- smp_aggra[[i]]
p <- ggplot(df, aes(x=1:nrow(df), y=smp_mean, group = 1)) +
geom_errorbar(aes(ymin=smp_mean-smp_sd, ymax=smp_mean+smp_sd), width=.1) +
geom_line() + geom_point() + xlab('weeks') + ylab('mean') + ggtitle(i)
ggsave(p,file = file.path(dir_data,'figure','week_aggra',paste(i,'.jpg',sep='')))
x <- lapply(1:2000,plot_week_aggra)
fit <- auto.arima(df$smp_mean,D = 1,trace = F,
max.P = 0,max.Q = 0,max.p = 20,max.q = 20,
ic = 'aic')
require(forecast)
require('forecast')
install.packages('forecast')
install.packages('forecast')
install.packages('ggplot2')
install.packages("ggplot2")
install.packages("ggplot2")
install.packages("ggplot2")
install.packages('ggplot2')
install.packages('ggplot2')
install.packages('forecast')
rm(list = ls())
source('head.R')
source('gen_result_last_week_Func.R')
source('base.R')
load(file.path(dir_data,'shop_pay.Rda'))
load(file.path(dir_data,'shop_info.Rda'))
load(file.path(dir_data,'smp_aggra.Rda')) #smp_aggra <- gen_smp_aggra(shop_pay,test_start,k)
# load(file.path(dir_data,'volt_limit_set.Rda'))
df <- smp_aggra[[1]]
fit <- auto.arima(df$smp_mean,D = 1,trace = F,
max.P = 0,max.Q = 0,max.p = 20,max.q = 20,
ic = 'aic')
require(forecast)
fit <- auto.arima(df$smp_mean,D = 1,trace = F,
max.P = 0,max.Q = 0,max.p = 20,max.q = 20,
ic = 'aic')
fc <- forecast.Arima(fit,h = length(2))
fc$mean
fc <- forecast.Arima(fit,h = 2)
fit_mean <- auto.arima(df$smp_mean,D = 1,trace = F,
max.P = 0,max.Q = 0,max.p = 20,max.q = 20,
ic = 'aic')
pred_mean <- forecast.Arima(fit,h = 2)
fit_sd <- auto.arima(df$smp_sd,D = 1,trace = F,
max.P = 0,max.Q = 0,max.p = 20,max.q = 20,
ic = 'aic')
pred_sd <- forecast.Arima(fit,h = 2)
df$uni_time <- as.p(df$uni_time)
rbind(c(df$uni_time+86400*7,pred_mean[1],pred_sd[1]),c(df$uni_time+86400*14,pred_mean[2],pred_sd[1]))
max_ut <- max(df$uni_time)
rbind(c(max_ut+86400*7,pred_mean[1],pred_sd[1]),c(max_ut+86400*14,pred_mean[2],pred_sd[1]))
rbind(c(max_ut+86400*7,pred_mean$mean[1],pred_sd$mean[1]),
c(max_ut+86400*14,pred_mean$mean[1],pred_sd$mean[1]))
rbind(c(as.POSIXct(max_ut+86400*7,tz = 'UTC',origin = '1970-01-01'),pred_mean$mean[1],pred_sd$mean[1]),
c(as.POSIXct(max_ut+86400*14,tz = 'UTC',origin = '1970-01-01'),pred_mean$mean[2],pred_sd$mean[2]))
as.POSIXct(max_ut+86400*7,tz = 'UTC',origin = '1970-01-01')
c(as.POSIXct(max_ut+86400*7,tz = 'UTC',origin = '1970-01-01'),pred_mean$mean[1],pred_sd$mean[1])
pred_mean$mean[1]
c(as.POSIXct(max_ut+86400*7,tz = 'UTC',origin = '1970-01-01'),pred_mean$mean[1],pred_sd$mean[1])
as.POSIXct(max_ut+86400*7,tz = 'UTC',origin = '1970-01-01')
pred_mean$mean[1]
rbind(data.frame(as.POSIXct(max_ut+86400*7,tz = 'UTC',origin = '1970-01-01'),pred_mean$mean[1],pred_sd$mean[1]),
data.frame(as.POSIXct(max_ut+86400*14,tz = 'UTC',origin = '1970-01-01'),pred_mean$mean[2],pred_sd$mean[2]))
rbind(df,data.frame(as.POSIXct(max_ut+86400*7,tz = 'UTC',origin = '1970-01-01'),pred_mean$mean[1],pred_sd$mean[1]),
data.frame(as.POSIXct(max_ut+86400*14,tz = 'UTC',origin = '1970-01-01'),pred_mean$mean[2],pred_sd$mean[2]))
data.frame(as.POSIXct(max_ut+86400*7,tz = 'UTC',origin = '1970-01-01'),pred_mean$mean[1],pred_sd$mean[1])
df,data.frame(uni_time = c(as.POSIXct(max_ut+86400*7,tz = 'UTC',origin = '1970-01-01'),
as.POSIXct(max_ut+86400*14,tz = 'UTC',origin = '1970-01-01')),
smp_mean = pred_mean$mean[1:2],
smp_sd = pred_sd$mean[1:2])
data.frame(uni_time = c(as.POSIXct(max_ut+86400*7,tz = 'UTC',origin = '1970-01-01'),
as.POSIXct(max_ut+86400*14,tz = 'UTC',origin = '1970-01-01')),
smp_mean = pred_mean$mean[1:2],
smp_sd = pred_sd$mean[1:2])
max_ut
as.POSIXct(max_ut+86400*7,tz = 'UTC',origin = '1970-01-01')
tmp <- data.frame(uni_time = c(as.POSIXct(max_ut+86400*7,tz = 'UTC',origin = '1970-01-01'),
as.POSIXct(max_ut+86400*14,tz = 'UTC',origin = '1970-01-01')),
smp_mean = pred_mean$mean[1:2],
smp_sd = pred_sd$mean[1:2])
tmp
tmp <- data.frame(uni_time = c(max_ut+86400*7,max_ut+86400*14),
smp_mean = pred_mean$mean[1:2],
smp_sd = pred_sd$mean[1:2])
tmp
max_ut
max_ut + 86400*7
tmp$uni_time[1]
View(df)
fit_mean <- auto.arima(df$smp_mean,D = 1,trace = F,
max.P = 0,max.Q = 0,max.p = 20,max.q = 20,
ic = 'aic')
pred_mean <- forecast.Arima(fit_mean,h = 2)
fit_sd <- auto.arima(df$smp_sd,D = 1,trace = F,
max.P = 0,max.Q = 0,max.p = 20,max.q = 20,
ic = 'aic')
pred_sd <- forecast.Arima(fit_sd,h = 2)
max_ut <- max(df$uni_time)
tmp <- data.frame(uni_time = c(max_ut+86400*7,max_ut+86400*14),
smp_mean = pred_mean$mean[1:2],
smp_sd = pred_sd$mean[1:2])
pred_mean$mean[1:2]
pred_sd$mean[1:2]
df <- smp_aggra[[2]]
View(df)
fit_mean <- auto.arima(df$smp_mean,D = 1,trace = F,
max.P = 0,max.Q = 0,max.p = 20,max.q = 20,
ic = 'aic')
pred_mean <- forecast.Arima(fit_mean,h = 2)
fit_sd <- auto.arima(df$smp_sd,D = 1,trace = F,
max.P = 0,max.Q = 0,max.p = 20,max.q = 20,
ic = 'aic')
pred_sd <- forecast.Arima(fit_sd,h = 2)
df$uni_time <- as.p(df$uni_time)
max_ut <- max(df$uni_time)
tmp <- data.frame(uni_time = c(max_ut+86400*7,max_ut+86400*14),
smp_mean = pred_mean$mean[1:2],
smp_sd = pred_sd$mean[1:2])
